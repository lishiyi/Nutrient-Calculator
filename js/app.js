/**
 * Controllers for the buttons and variables.
 */
$(function(){
    $('.start-genetic-algorithm').click(function(){
        $(this).hide();
        $('.pause-genetic-algorithm').show();
        testGeneticSoylent.autoGenerate = true;
        testGeneticSoylent.nextGeneration();
        return false;
    });

    $('.pause-genetic-algorithm').click(function(){
        testGeneticSoylent.autoGenerate = false;
        $(this).hide();
        $('.start-genetic-algorithm').show();
        return false;
    });

    $('.step-genetic-algorithm').click(function(){
        testGeneticSoylent.nextGeneration();
        return false;
    });

    $('.reset-genetic-algorithm').click(function(){
        testGeneticSoylent.reset();
        testGeneticSoylent.render();
        return false;
    });

    $('.death-rate').change(function(){
        testGeneticSoylent.deathRate = Number($(this).val());
    });

    $('.population').change(function(){
        testGeneticSoylent.populationSize = Number($(this).val());
    });

    $('.mutation-probability').change(function(){
        testGeneticSoylent.mutationProbability = Number($(this).val());
    });

    $('.mutation-multiplier').change(function(){
        testGeneticSoylent.mutationMultiplier = Number($(this).val());
    });

    $('#inputJSON').change(function(){
        var jsonToRun = $.parseJSON(this.value);
        if(!jsonToRun.ingredients) { jsonToRun.ingredients = {"ingredients": [{"Nothing":""},]}  };
        testGeneticSoylent = new GeneticSoylent({
                    ingredients: convertJSONIngredientsToGeneticIngredients(jsonToRun.ingredients),
                    targetNutrients: convertJSONNutritionToGeneticNutrition(jsonToRun.nutrientTargets)
        });

        testGeneticSoylent.reset();
        testGeneticSoylent.render();
    });

    function convertJSONIngredientsToGeneticIngredients(ingredients0){

        //document.write("<script type="text/javascript" src="js/defaultJson.js"></script>");
        var ingredients = [
      {
      "persistedAsin": "",
      "name": "Soy Lecithin Granules",
      "form": "Powder",
      "unit": "g",
      "container_size": 11339.8,
      "item_cost": 119.4,
      "source": "Amazon",
      "url": "http://www.bobsredmill.com/soy-lecithin-granules.html",
      "amount": 25,
      "volume": null,
      "volume_unit": "cup",
      "serving": 8,
      "calories": 60,
      "carbs": 1,
      "protein": 0,
      "fat": 4,
      "saturated-fat": 1,
      "monounsaturated-fat": 0,
      "polyunsaturated-fat": 0,
      "omega_3": 0,
      "omega_6": 0,
      "fiber": 0,
      "soluble-fiber": 0,
      "insoluble-fiber": 0,
      "cholesterol": 0,
      "calcium": 0.02,
      "chloride": 0,
      "chromium": 0,
      "copper": 0,
      "iodine": 0,
      "iron": 0.016,
      "magnesium": 0,
      "maganese": 0,
      "molybdenum": 0,
      "phosphorus": 0,
      "potassium": 0,
      "selinium": 0,
      "sodium": 0,
      "sulfur": 0,
      "zinc": 0,
      "vitamin_a": 0,
      "vitamin_b6": 0,
      "vitamin_b12": 0,
      "vitamin_c": 0,
      "vitamin_d": 0,
      "vitamin_e": 0,
      "vitamin_k": 0,
      "thiamin": 0,
      "riboflavin": 0,
      "niacin": 0,
      "folate": 0,
      "panthothenic": 0,
      "biotin": 0,
      "choline": 275,
      "_id": "5579efc6039f44c130eb3a20",
      "currency": "$",
      "asin": "",
      "volumeStr": "",
      "id": "5579efc6039f44c130eb3a20"
    },
    {
      "persistedAsin": "B004VLVG0M",
      "name": "Sea Salt",
      "form": "Powder",
      "unit": "g",
      "container_size": 2267.96,
      "item_cost": 22.5,
      "source": "Amazon (S)",
      "url": "https://www.amazon.com/dp/B004VLVG0M?tag=19-82341-20",
      "amount": 3.6,
      "volume": null,
      "volume_unit": "cup",
      "serving": 1,
      "calories": 0,
      "carbs": 0,
      "protein": 0,
      "fat": 0,
      "saturated-fat": 0,
      "monounsaturated-fat": 0,
      "polyunsaturated-fat": 0,
      "omega_3": 0,
      "omega_6": 0,
      "fiber": 0,
      "soluble-fiber": 0,
      "insoluble-fiber": 0,
      "cholesterol": 0,
      "calcium": 0,
      "chloride": 0.61,
      "chromium": 0,
      "copper": 0,
      "iodine": 50,
      "iron": 0,
      "magnesium": 0,
      "maganese": 0,
      "molybdenum": 0,
      "phosphorus": 0,
      "potassium": 0,
      "selinium": 0,
      "sodium": 0.39,
      "sulfur": 0,
      "zinc": 0,
      "vitamin_a": 0,
      "vitamin_b6": 0,
      "vitamin_b12": 0,
      "vitamin_c": 0,
      "vitamin_d": 0,
      "vitamin_e": 0,
      "vitamin_k": 0,
      "thiamin": 0,
      "riboflavin": 0,
      "niacin": 0,
      "folate": 0,
      "panthothenic": 0,
      "biotin": 0,
      "choline": 0,
      "_id": "5579efc6039f44c130eb3a1f",
      "currency": "$",
      "asin": "B004VLVG0M",
      "volumeStr": "",
      "id": "5579efc6039f44c130eb3a1f"
    },
    {
      "persistedAsin": "",
      "name": "Sunflower Seeds",
      "form": "Powder",
      "unit": "g",
      "container_size": 11339.8,
      "item_cost": 44,
      "source": "Amazon",
      "url": "http://www.bobsredmill.com/raw-shelled-sunflower-seeds.html",
      "amount": 44,
      "volume": null,
      "volume_unit": "cup",
      "serving": 100,
      "calories": 584,
      "carbs": 20,
      "protein": 21,
      "fat": 51,
      "saturated-fat": 4,
      "monounsaturated-fat": 0,
      "polyunsaturated-fat": 0,
      "omega_3": 0.074,
      "omega_6": 23.048,
      "fiber": 9,
      "soluble-fiber": 0,
      "insoluble-fiber": 0,
      "cholesterol": 0,
      "calcium": 0.078,
      "chloride": 0,
      "chromium": 0,
      "copper": 1.8,
      "iodine": 0,
      "iron": 5.2,
      "magnesium": 325,
      "maganese": 1.9,
      "molybdenum": 0,
      "phosphorus": 0.66,
      "potassium": 0.645,
      "selinium": 53,
      "sodium": 0.009,
      "sulfur": 0,
      "zinc": 5,
      "vitamin_a": 50,
      "vitamin_b6": 1.3,
      "vitamin_b12": 0,
      "vitamin_c": 1.4,
      "vitamin_d": 0,
      "vitamin_e": 33,
      "vitamin_k": 0,
      "thiamin": 1.5,
      "riboflavin": 0.4,
      "niacin": 8.3,
      "folate": 227,
      "panthothenic": 1.13,
      "biotin": 66,
      "choline": 55.1,
      "_id": "5579efc6039f44c130eb3a1e",
      "currency": "$",
      "asin": "",
      "volumeStr": "",
      "id": "5579efc6039f44c130eb3a1e"
    },
    {
      "persistedAsin": "",
      "name": "Barley Malt Flour",
      "form": "Powder",
      "unit": "g",
      "container_size": 24947.6,
      "item_cost": 55,
      "source": "Midwest Supplies",
      "url": "http://www.midwestsupplies.com/caramel-crystal-cara-malt.html",
      "amount": 204,
      "volume": null,
      "volume_unit": "cup",
      "serving": 100,
      "calories": 361,
      "carbs": 78.3,
      "protein": 10.28,
      "fat": 1.84,
      "saturated-fat": 0.386,
      "monounsaturated-fat": 0.254,
      "polyunsaturated-fat": 0.953,
      "omega_3": 0.095,
      "omega_6": 0.859,
      "fiber": 7.1,
      "soluble-fiber": 0,
      "insoluble-fiber": 0,
      "cholesterol": 0,
      "calcium": 0.037,
      "chloride": 0.011,
      "chromium": 0,
      "copper": 0.27,
      "iodine": 0,
      "iron": 4.71,
      "magnesium": 97,
      "maganese": 1.193,
      "molybdenum": 0,
      "phosphorus": 0.303,
      "potassium": 0.224,
      "selinium": 37.7,
      "sodium": 0.011,
      "sulfur": 0.45099999999999996,
      "zinc": 2.06,
      "vitamin_a": 19,
      "vitamin_b6": 0.655,
      "vitamin_b12": 0,
      "vitamin_c": 0.6,
      "vitamin_d": 0,
      "vitamin_e": 0.57,
      "vitamin_k": 2.2,
      "thiamin": 0.309,
      "riboflavin": 0.308,
      "niacin": 5.636,
      "folate": 38,
      "panthothenic": 0.577,
      "biotin": 0,
      "choline": 0,
      "_id": "5579efc6039f44c130eb3a1d",
      "currency": "$",
      "asin": "",
      "volumeStr": "",
      "id": "5579efc6039f44c130eb3a1d"
    },
    {
      "persistedAsin": "",
      "name": "Brown Rice Protein Isolate",
      "form": "Powder",
      "unit": "g",
      "container_size": 24947.6,
      "item_cost": 350,
      "source": "Amazon",
      "url": "r",
      "amount": 46,
      "volume": null,
      "volume_unit": "cup",
      "serving": 27,
      "calories": 100,
      "carbs": 1,
      "protein": 24,
      "fat": 0,
      "saturated-fat": 0,
      "monounsaturated-fat": 0,
      "polyunsaturated-fat": 0,
      "omega_3": 0,
      "omega_6": 0,
      "fiber": 1,
      "soluble-fiber": 0,
      "insoluble-fiber": 0,
      "cholesterol": 0,
      "calcium": 0,
      "chloride": 0,
      "chromium": 0,
      "copper": 0,
      "iodine": 0,
      "iron": 1.2,
      "magnesium": 0,
      "maganese": 0,
      "molybdenum": 0,
      "phosphorus": 0,
      "potassium": 0,
      "selinium": 0,
      "sodium": 0,
      "sulfur": 1.098,
      "zinc": 0,
      "vitamin_a": 0,
      "vitamin_b6": 0,
      "vitamin_b12": 0,
      "vitamin_c": 0,
      "vitamin_d": 0,
      "vitamin_e": 0,
      "vitamin_k": 0,
      "thiamin": 0,
      "riboflavin": 0,
      "niacin": 0,
      "folate": 0,
      "panthothenic": 0,
      "biotin": 0,
      "choline": 0,
      "_id": "5579efc6039f44c130eb3a1c",
      "currency": "$",
      "asin": "",
      "volumeStr": "",
      "id": "5579efc6039f44c130eb3a1c"
    },
    {
      "persistedAsin": "B001DB4MFO",
      "name": "Pea Protein Powder",
      "form": "Powder",
      "unit": "g",
      "container_size": 19958.1,
      "item_cost": 245,
      "source": "Amazon",
      "url": "https://www.amazon.com/dp/B001DB4MFO?tag=19-82341-20",
      "amount": 40,
      "volume": null,
      "volume_unit": "cup",
      "serving": 33,
      "calories": 130,
      "carbs": 1,
      "protein": 28,
      "fat": 2,
      "saturated-fat": 0,
      "monounsaturated-fat": 0,
      "polyunsaturated-fat": 0,
      "omega_3": 0,
      "omega_6": 0,
      "fiber": 0.5,
      "soluble-fiber": 0,
      "insoluble-fiber": 0,
      "cholesterol": 0,
      "calcium": 0.04,
      "chloride": 0.33,
      "chromium": 0,
      "copper": 0,
      "iodine": 0,
      "iron": 7,
      "magnesium": 0,
      "maganese": 0,
      "molybdenum": 0,
      "phosphorus": 0,
      "potassium": 0,
      "selinium": 0,
      "sodium": 0.33,
      "sulfur": 0,
      "zinc": 0,
      "vitamin_a": 0,
      "vitamin_b6": 0,
      "vitamin_b12": 0,
      "vitamin_c": 0,
      "vitamin_d": 0,
      "vitamin_e": 0,
      "vitamin_k": 0,
      "thiamin": 0,
      "riboflavin": 0,
      "niacin": 0,
      "folate": 0,
      "panthothenic": 0,
      "biotin": 0,
      "choline": 0,
      "_id": "5579efc6039f44c130eb3a1b",
      "currency": "$",
      "asin": "B001DB4MFO",
      "volumeStr": "",
      "id": "5579efc6039f44c130eb3a1b"
    },
    {
      "persistedAsin": "B00028M47C",
      "name": "Nutritional Yeast Powder",
      "form": "Powder",
      "unit": "g",
      "container_size": 4536,
      "item_cost": 98.96,
      "source": "Amazon",
      "url": "https://www.amazon.com/dp/B00028M47C?tag=19-82341-20",
      "amount": 3.5,
      "volume": null,
      "volume_unit": "cup",
      "serving": 16,
      "calories": 60,
      "carbs": 5,
      "protein": 9,
      "fat": 1,
      "saturated-fat": 0,
      "monounsaturated-fat": 0,
      "polyunsaturated-fat": 0,
      "omega_3": 0,
      "omega_6": 0,
      "fiber": 4,
      "soluble-fiber": 0,
      "insoluble-fiber": 0,
      "cholesterol": 0,
      "calcium": 0,
      "chloride": 0.046,
      "chromium": 0,
      "copper": 0,
      "iodine": 0,
      "iron": 0.4,
      "magnesium": 0,
      "maganese": 0,
      "molybdenum": 0,
      "phosphorus": 0,
      "potassium": 0,
      "selinium": 16.5,
      "sodium": 0,
      "sulfur": 0,
      "zinc": 0,
      "vitamin_a": 0,
      "vitamin_b6": 7.28,
      "vitamin_b12": 9.6,
      "vitamin_c": 0,
      "vitamin_d": 0,
      "vitamin_e": 0,
      "vitamin_k": 0,
      "thiamin": 8.04,
      "riboflavin": 7.67,
      "niacin": 44.8,
      "folate": 720,
      "panthothenic": 0.5,
      "biotin": 0,
      "choline": 0,
      "_id": "5579efc6039f44c130eb3a1a",
      "currency": "$",
      "asin": "B00028M47C",
      "volumeStr": "",
      "id": "5579efc6039f44c130eb3a1a"
    },
    {
      "persistedAsin": "",
      "name": "Oat Flour",
      "form": "Powder",
      "unit": "g",
      "container_size": 11340,
      "item_cost": 37.3,
      "source": "Bob's Red Mill (4x 22oz)",
      "url": "http://www.bobsredmill.com/whole-grain-oat-flour.html",
      "amount": 155,
      "volume": null,
      "volume_unit": "cup",
      "serving": 100,
      "calories": 400,
      "carbs": 59.2,
      "protein": 14.7,
      "fat": 9.1,
      "saturated-fat": 1.6,
      "monounsaturated-fat": 2.9,
      "polyunsaturated-fat": 3.3,
      "omega_3": 0.145,
      "omega_6": 3.185,
      "fiber": 6.5,
      "soluble-fiber": 3,
      "insoluble-fiber": 3.5,
      "cholesterol": 0,
      "calcium": 0.055,
      "chloride": 0,
      "chromium": 0,
      "copper": 0.4,
      "iodine": 0,
      "iron": 4,
      "magnesium": 144,
      "maganese": 4,
      "molybdenum": 200,
      "phosphorus": 0.453,
      "potassium": 0.371,
      "selinium": 34,
      "sodium": 0.019,
      "sulfur": 0.23,
      "zinc": 3.2,
      "vitamin_a": 0,
      "vitamin_b6": 0.1,
      "vitamin_b12": 0,
      "vitamin_c": 0,
      "vitamin_d": 0,
      "vitamin_e": 1,
      "vitamin_k": 3.2,
      "thiamin": 0.7,
      "riboflavin": 0.1,
      "niacin": 1.5,
      "folate": 32,
      "panthothenic": 0.2,
      "biotin": 0,
      "choline": 29.9,
      "_id": "5579efc6039f44c130eb3a19",
      "currency": "$",
      "asin": "",
      "volumeStr": "",
      "id": "5579efc6039f44c130eb3a19"
    },
    {
      "persistedAsin": "B004VLVD50",
      "name": "Brown Rice Flour Brown",
      "form": "Powder",
      "unit": "g",
      "container_size": 11340,
      "item_cost": 26.34,
      "source": "Amazon",
      "url": "https://www.amazon.com/dp/B004VLVD50?tag=19-82341-20",
      "amount": 161,
      "volume": null,
      "volume_unit": "cup",
      "serving": 40,
      "calories": 140,
      "carbs": 31,
      "protein": 3,
      "fat": 1,
      "saturated-fat": 0,
      "monounsaturated-fat": 0,
      "polyunsaturated-fat": 0,
      "omega_3": 0,
      "omega_6": 0,
      "fiber": 2,
      "soluble-fiber": 0,
      "insoluble-fiber": 0,
      "cholesterol": 0,
      "calcium": 0,
      "chloride": 0,
      "chromium": 0,
      "copper": 0,
      "iodine": 0,
      "iron": 0,
      "magnesium": 0,
      "maganese": 0,
      "molybdenum": 0,
      "phosphorus": 0,
      "potassium": 0,
      "selinium": 0,
      "sodium": 0.05,
      "sulfur": 0,
      "zinc": 0,
      "vitamin_a": 0,
      "vitamin_b6": 0,
      "vitamin_b12": 0,
      "vitamin_c": 0,
      "vitamin_d": 0,
      "vitamin_e": 0,
      "vitamin_k": 0,
      "thiamin": 0,
      "riboflavin": 0,
      "niacin": 0,
      "folate": 0,
      "panthothenic": 0,
      "biotin": 0,
      "choline": 0,
      "_id": "5579efc6039f44c130eb3a18",
      "currency": "$",
      "asin": "B004VLVD50",
      "volumeStr": "",
      "id": "5579efc6039f44c130eb3a18"
    },
    {
      "persistedAsin": "B00JYF1J2U",
      "name": "Camu Camu Powder",
      "form": "Powder",
      "unit": "g",
      "container_size": 2267.96,
      "item_cost": 255,
      "source": "Amazon",
      "url": "https://www.amazon.com/dp/B00JYF1J2U?tag=19-82341-20",
      "amount": 1,
      "volume": null,
      "volume_unit": "cup",
      "serving": 1,
      "calories": 0,
      "carbs": 0,
      "protein": 0,
      "fat": 0,
      "saturated-fat": 0,
      "monounsaturated-fat": 0,
      "polyunsaturated-fat": 0,
      "omega_3": 0,
      "omega_6": 0,
      "fiber": 0,
      "soluble-fiber": 0,
      "insoluble-fiber": 0,
      "cholesterol": 0,
      "calcium": 0,
      "chloride": 0,
      "chromium": 0,
      "copper": 0,
      "iodine": 0,
      "iron": 0,
      "magnesium": 0,
      "maganese": 0,
      "molybdenum": 0,
      "phosphorus": 0,
      "potassium": 0.024,
      "selinium": 0,
      "sodium": 0,
      "sulfur": 0,
      "zinc": 0,
      "vitamin_a": 0,
      "vitamin_b6": 0,
      "vitamin_b12": 0,
      "vitamin_c": 200,
      "vitamin_d": 0,
      "vitamin_e": 0,
      "vitamin_k": 0,
      "thiamin": 0,
      "riboflavin": 0,
      "niacin": 0,
      "folate": 0,
      "panthothenic": 0,
      "biotin": 0,
      "choline": 0,
      "_id": "5579efc6039f44c130eb3a17",
      "currency": "$",
      "asin": "B00JYF1J2U",
      "volumeStr": "",
      "id": "5579efc6039f44c130eb3a17"
    },
    {
      "persistedAsin": "",
      "name": "Seeds, chia seeds, dried",
      "form": "Powder",
      "unit": "g",
      "container_size": 24947.6,
      "item_cost": 350,
      "source": "",
      "url": "",
      "amount": 5,
      "volume": null,
      "volume_unit": "cup",
      "serving": 100,
      "calories": 486,
      "carbs": 42.12,
      "protein": 16.54,
      "fat": 30.74,
      "saturated-fat": 3.33,
      "monounsaturated-fat": 2.309,
      "polyunsaturated-fat": 23.665,
      "omega_3": 17.83,
      "omega_6": 5.835,
      "fiber": 34.4,
      "soluble-fiber": 0,
      "insoluble-fiber": 0,
      "cholesterol": 0,
      "calcium": 0.631,
      "chloride": 0,
      "chromium": 0,
      "copper": 0.924,
      "iodine": 0,
      "iron": 7.72,
      "magnesium": 335,
      "maganese": 2.723,
      "molybdenum": 0,
      "phosphorus": 0.86,
      "potassium": 0.40700000000000003,
      "selinium": 55.2,
      "sodium": 0.016,
      "sulfur": 0.9949999999999999,
      "zinc": 4.58,
      "vitamin_a": 54,
      "vitamin_b6": 0,
      "vitamin_b12": 0,
      "vitamin_c": 1.6,
      "vitamin_d": 0,
      "vitamin_e": 0.5,
      "vitamin_k": 0,
      "thiamin": 0.62,
      "riboflavin": 0.17,
      "niacin": 8.83,
      "folate": 49,
      "panthothenic": 0,
      "biotin": 0,
      "choline": 0,
      "_id": "5579efc6039f44c130eb3a16",
      "currency": "$",
      "asin": "",
      "volumeStr": "",
      "id": "5579efc6039f44c130eb3a16"
    },
    {
      "persistedAsin": "",
      "name": "greenMix",
      "form": "Powder",
      "unit": "g",
      "container_size": 24947.6,
      "item_cost": 825,
      "source": "",
      "url": "",
      "amount": 5,
      "volume": null,
      "volume_unit": "cup",
      "serving": 8,
      "calories": 25,
      "carbs": 4,
      "protein": 3,
      "fat": 0,
      "saturated-fat": 0,
      "monounsaturated-fat": 0,
      "polyunsaturated-fat": 0,
      "omega_3": 0,
      "omega_6": 0,
      "fiber": 2,
      "soluble-fiber": 0,
      "insoluble-fiber": 0,
      "cholesterol": 0,
      "calcium": 0.1,
      "chloride": 0,
      "chromium": 0,
      "copper": 0,
      "iodine": 0,
      "iron": 2,
      "magnesium": 0,
      "maganese": 0,
      "molybdenum": 0,
      "phosphorus": 0,
      "potassium": 0,
      "selinium": 0,
      "sodium": 0,
      "sulfur": 0,
      "zinc": 0,
      "vitamin_a": 1500,
      "vitamin_b6": 1,
      "vitamin_b12": 0,
      "vitamin_c": 0,
      "vitamin_d": 0,
      "vitamin_e": 0,
      "vitamin_k": 0,
      "thiamin": 4,
      "riboflavin": 1,
      "niacin": 10,
      "folate": 0,
      "panthothenic": 0,
      "biotin": 0,
      "choline": 0,
      "_id": "5579efc6039f44c130eb3a15",
      "currency": "$",
      "asin": "",
      "volumeStr": "",
      "id": "5579efc6039f44c130eb3a15"
    },
    {
      "persistedAsin": "",
      "name": "Syrup, cane",
      "form": "Powder",
      "unit": "g",
      "container_size": 907.185,
      "item_cost": 8,
      "source": "",
      "url": "",
      "amount": 12,
      "volume": null,
      "volume_unit": "cup",
      "serving": 100,
      "calories": 269,
      "carbs": 73.14,
      "protein": 0,
      "fat": 0,
      "saturated-fat": 0,
      "monounsaturated-fat": 0,
      "polyunsaturated-fat": 0,
      "omega_3": 0,
      "omega_6": 0,
      "fiber": 0,
      "soluble-fiber": 0,
      "insoluble-fiber": 0,
      "cholesterol": 0,
      "calcium": 0.013000000000000001,
      "chloride": 0,
      "chromium": 0,
      "copper": 0.02,
      "iodine": 0,
      "iron": 3.6,
      "magnesium": 10,
      "maganese": 0,
      "molybdenum": 0,
      "phosphorus": 0.008,
      "potassium": 0.063,
      "selinium": 0.7,
      "sodium": 0.058,
      "sulfur": 0,
      "zinc": 0.19,
      "vitamin_a": 0,
      "vitamin_b6": 0,
      "vitamin_b12": 0,
      "vitamin_c": 0,
      "vitamin_d": 0,
      "vitamin_e": 0,
      "vitamin_k": 0,
      "thiamin": 0.13,
      "riboflavin": 0.06,
      "niacin": 0.1,
      "folate": 0,
      "panthothenic": 0,
      "biotin": 0,
      "choline": 0,
      "_id": "5579efc6039f44c130eb3a14",
      "currency": "$",
      "asin": "",
      "volumeStr": "",
      "id": "5579efc6039f44c130eb3a14"
    },
    {
      "persistedAsin": "B000EDDSE8",
      "name": "Golden Flax Meal",
      "form": "Powder",
      "unit": "g",
      "container_size": 11339.8,
      "item_cost": 42.8,
      "source": "Amazon",
      "url": "https://www.amazon.com/dp/B000EDDSE8?tag=19-82341-20",
      "amount": 5,
      "volume": null,
      "volume_unit": "cup",
      "serving": 100,
      "calories": 534,
      "carbs": 28.88,
      "protein": 18.29,
      "fat": 42.16,
      "saturated-fat": 3.663,
      "monounsaturated-fat": 7.527,
      "polyunsaturated-fat": 28.73,
      "omega_3": 22.813,
      "omega_6": 5.903,
      "fiber": 27.3,
      "soluble-fiber": 0,
      "insoluble-fiber": 0,
      "cholesterol": 0,
      "calcium": 0.255,
      "chloride": 0.03,
      "chromium": 0,
      "copper": 1.22,
      "iodine": 0,
      "iron": 5.73,
      "magnesium": 392,
      "maganese": 2.482,
      "molybdenum": 0,
      "phosphorus": 0.642,
      "potassium": 0.8130000000000001,
      "selinium": 25.4,
      "sodium": 0.03,
      "sulfur": 0.71,
      "zinc": 4.34,
      "vitamin_a": 0,
      "vitamin_b6": 0.473,
      "vitamin_b12": 0,
      "vitamin_c": 0.6,
      "vitamin_d": 0,
      "vitamin_e": 0.31,
      "vitamin_k": 4.3,
      "thiamin": 1.644,
      "riboflavin": 0.161,
      "niacin": 3.08,
      "folate": 87,
      "panthothenic": 0.985,
      "biotin": 0,
      "choline": 78.7,
      "_id": "5579efc6039f44c130eb3a13",
      "currency": "$",
      "asin": "B000EDDSE8",
      "volumeStr": "",
      "id": "5579efc6039f44c130eb3a13"
    },
    {
      "persistedAsin": "",
      "name": "Kale, raw",
      "form": "Powder",
      "unit": "g",
      "container_size": 0,
      "item_cost": 0,
      "source": "",
      "url": "",
      "amount": 0,
      "volume": null,
      "volume_unit": "cup",
      "serving": 100,
      "calories": 49,
      "carbs": 8.75,
      "protein": 4.28,
      "fat": 0.93,
      "saturated-fat": 0.091,
      "monounsaturated-fat": 0.052,
      "polyunsaturated-fat": 0.338,
      "omega_3": 0.18,
      "omega_6": 0.138,
      "fiber": 3.6,
      "soluble-fiber": 0,
      "insoluble-fiber": 0,
      "cholesterol": 0,
      "calcium": 0.15,
      "chloride": 0,
      "chromium": 0,
      "copper": 1.499,
      "iodine": 0,
      "iron": 1.47,
      "magnesium": 47,
      "maganese": 0.659,
      "molybdenum": 0,
      "phosphorus": 0.092,
      "potassium": 0.491,
      "selinium": 0.9,
      "sodium": 0.038,
      "sulfur": 0,
      "zinc": 0.56,
      "vitamin_a": 9990,
      "vitamin_b6": 0.271,
      "vitamin_b12": 0,
      "vitamin_c": 120,
      "vitamin_d": 0,
      "vitamin_e": 1.54,
      "vitamin_k": 704.8,
      "thiamin": 0.11,
      "riboflavin": 0.13,
      "niacin": 1,
      "folate": 141,
      "panthothenic": 0.091,
      "biotin": 0,
      "choline": 0.8,
      "_id": "5579efc6039f44c130eb3a12",
      "currency": "$",
      "asin": "",
      "volumeStr": "",
      "id": "5579efc6039f44c130eb3a12"
    },
        ];

        $.each(ingredients, function(key, value){
            // divide each value by serving size to normalize them
            var servingSize = ingredients[key]["serving"];

            // if servingSize = 0, we use amount instead
            if (!servingSize){
                servingSize = ingredients[key]["amount"];
            }

            // if both are 0, we use 1
            if (!servingSize){
                servingSize = 1;
            }

            // set the nutrient value for each nutrient to the amount in
            // 1 unit of this ingredient (usually 1g, 1pill)
            $.each(value, function(ingredientNutrient, ingredientValue){
                if (Number(ingredients[key][ingredientNutrient])) {
                   ingredients[key][ingredientNutrient] = ingredientValue/servingSize;
               }
            });
            // also, for each ingredient, add a maxAmount
            ingredients[key]["maxAmount"] = 500;
            ingredients[key]["minAmount"] =   0;

            // get the cost of the item per unit of measure
            ingredients[key]["cost"] = ingredients[key]["item_cost"] / ingredients[key]["container_size"];
        });
        return ingredients;
    }

    function convertJSONNutritionToGeneticNutrition(nutrition){
        //var newNutrition = [];


        var tempNutrition = {
            "soluble-fiber_max": 0,
            "soluble-fiber": 0,
            "saturated-fat_max": 0,
            "saturated-fat": 0,
            "polyunsaturated-fat_max": 0,
            "polyunsaturated-fat": 0,
            "monounsaturated-fat_max": 0,
            "monounsaturated-fat": 0,
            "insoluble-fiber_max": 0,
            "insoluble-fiber": 0,
            "name": "Sebastian",
            "calories": 2833,
            "calories_max": 0,
            "carbs": 404,
            "carbs_max": 0,
            "protein": 142,
            "protein_max": 0,
            "fat": 63,
            "fat_max": 0,
            "omega_3": 1.6,
            "omega_3_max": 0,
            "omega_6": 17,
            "omega_6_max": 0,
            "fiber": 28,
            "fiber_max": 0,
            "cholesterol": 0,
            "cholesterol_max": 0,
            "calcium": 1,
            "calcium_max": 2.5,
            "chloride": 2.3,
            "chloride_max": 3.6,
            "chromium": 35,
            "chromium_max": 0,
            "copper": 0.9,
            "copper_max": 10,
            "iodine": 150,
            "iodine_max": 1100,
            "iron": 8,
            "iron_max": 45,
            "magnesium": 420,
            "magnesium_max": 0,
            "maganese": 2.3,
            "maganese_max": 11,
            "molybdenum": 45,
            "molybdenum_max": 2000,
            "phosphorus": 0.7,
            "phosphorus_max": 4,
            "potassium": 3.5,
            "potassium_max": 0,
            "selinium": 55,
            "selinium_max": 400,
            "sodium": 1.5,
            "sodium_max": 2.3,
            "sulfur": 2,
            "sulfur_max": 0,
            "zinc": 11,
            "zinc_max": 40,
            "vitamin_a": 3000,
            "vitamin_a_max": 10000,
            "vitamin_b6": 1.3,
            "vitamin_b6_max": 100,
            "vitamin_b12": 2.4,
            "vitamin_b12_max": 0,
            "vitamin_c": 90,
            "vitamin_c_max": 2000,
            "vitamin_d": 600,
            "vitamin_d_max": 4000,
            "vitamin_e": 20,
            "vitamin_e_max": 1000,
            "vitamin_k": 120,
            "vitamin_k_max": 0,
            "thiamin": 1.2,
            "thiamin_max": 0,
            "riboflavin": 1.3,
            "riboflavin_max": 0,
            "niacin": 16,
            "niacin_max": 35,
            "folate": 400,
            "folate_max": 1000,
            "panthothenic": 5,
            "panthothenic_max": 0,
            "biotin": 30,
            "biotin_max": 0,
            "choline": 550,
            "choline_max": 3500
          };


        $.each(nutrition, function(key, value){
            tempNutrition.key = value;
        });

        /*
        if(nutrition.gender == "male"){
            if(nutrition.gender.age >= 9 && nutrition.gender.age <= 13){
                
            }
        }
        */

        var newNutrition = [];

        $.each(tempNutrition, function(key, value){
            // get the name of the trueKey, which doesn't include _max
            // later, we will put the value of _max into the key max of the nutrient trueKey
            var trueKey = key.replace("_max","");

            // if the object for this nutrient doesn't exist yet, add it
            // but only if the value > 0
            if (!newNutrition[trueKey] && value > 0){
                newNutrition[trueKey] = {};
            }

            // if this is a _max nutrition key, add it as the max value to trueKey
            if (key.indexOf("_max") >= 0 && value > 0){
                newNutrition[trueKey.replace("_max","")]["max"] = value;
                newNutrition[trueKey]["min"] = 0;
                newNutrition[trueKey]["importanceFactor"] = 1;
            }

            // otherwise take this value as the min and set the default importanceFactor
            // but only if the min value is > 0
            else if (value > 0) {
                newNutrition[trueKey]["min"] = value;
                newNutrition[trueKey]["importanceFactor"] = 1;
                // we'll need to add a max for all values, so
                // if it's othrewise undefined, we choose min*10
                if (!newNutrition[trueKey]["max"]){
                    newNutrition[trueKey]["max"] = newNutrition[trueKey]["min"] * 10;
                }
            }
        });

        // we delete "name", since it's not a nutrient
        delete newNutrition["name"];

        // we make the calorie defaults more reasonable
        newNutrition["calories"]["max"] = newNutrition["calories"]["min"] + 100;
        newNutrition["calories"]["min"] = newNutrition["calories"]["min"] - 100;

        // also add a cost target
        newNutrition["cost"] = {
            min: 0,
            max: 10,
            importanceFactor: 1
        };

        return newNutrition;
    }

    // Get parameter from URL
    // Taken from: https://gist.github.com/varemenos/2531765
    function getUrlVar(key){
        var result = new RegExp(key + "=([^&]*)", "i").exec(window.location.search);
        return result && unescape(result[1]) || "";
    }

    $(document).ready(function() {
        var loadRecipe = getUrlVar("recipe");
        if (loadRecipe) {
            var queryString = "http://diy.soylent.me/recipes/" + loadRecipe + "/json?callback=?";
            // As always, thanks stackoverflow:
            // http://stackoverflow.com/questions/6809053/simple-jquery-php-and-jsonp-example
            $.getJSON(queryString,'geneticCallback',function(dataToLoad){
                testGeneticSoylent = new GeneticSoylent({
                            ingredients: convertJSONIngredientsToGeneticIngredients(dataToLoad.ingredients),
                            targetNutrients: convertJSONNutritionToGeneticNutrition(dataToLoad.nutrientTargets)
                });

                testGeneticSoylent.reset();
                testGeneticSoylent.render();
            });
        }
    });

    testGeneticSoylent.render();
});
